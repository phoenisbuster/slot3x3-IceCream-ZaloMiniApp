import e from'./../external/@swc/helpers/src/_async_to_generator.mjs.js';import{object as r,number as o}from'./../external/zod/lib/index.mjs.js';import n from"../appEnv/index.js";import t from"../common/notFound.js";import{functionHandler as s}from"../utils/decorator.js";import i from"../utils/lodash.js";import{APIS as a}from"../constants.js";import l from"../common/apis/general/openProfilePicker.js";import u from"../common/token.js";import{__generator as d}from'./../external/tslib/tslib.es6.js';var m=[r({maxProfile:o().min(1).max(10).optional().default(1)})];function c(e){return p.apply(this,arguments)}function p(){return p=e((function(r){return d(this,(function(o){return[2,s("openProfilePicker",m,[r],(c=e((function(e){var r,o,s,m,c;return d(this,(function(d){switch(d.label){case 0:return n.isMp?[4,l(null==e?void 0:e.maxProfile)]:[3,8];case 1:if(!((r=d.sent()).length>0))return[3,7];d.label=2;case 2:return d.trys.push([2,6,,7]),[4,u.getAccessToken()];case 3:return s=d.sent(),[4,fetch(a.GET_LIST_USER_INFO,{method:"POST",headers:{"Content-Type":"application/json",access_token:s||""},body:JSON.stringify({fields:"id,name,picture",user_ids:r})})];case 4:return[4,d.sent().json()];case 5:if(0!==(m=d.sent()).error||!m.data)throw new Error(m.message);return o=r.map((function(e){var r,o,n,t,s,a,l,u,d,c,p;return{id:(null===(r=m.data[e])||void 0===r||null===(o=r.user_info)||void 0===o?void 0:o.user_id_by_app)||"",profile:{name:null===(n=m.data[e])||void 0===n||null===(t=n.user_info)||void 0===t?void 0:t.name,avatar:null===(s=m.data[e])||void 0===s||null===(a=s.user_info)||void 0===a||null===(l=a.picture)||void 0===l||null===(u=l.data)||void 0===u?void 0:u.url},code:0!==(null===(d=m.data[e])||void 0===d?void 0:d.error)?-1:0,message:"Get profile: ".concat(i.isUndefined(null===(c=m.data[e])||void 0===c?void 0:c.message)?"Unknown error":null===(p=m.data[e])||void 0===p?void 0:p.message)}})),[3,7];case 6:return c=d.sent(),o=r.map((function(e){return{id:e,profile:{name:"",avatar:""},code:-1,message:"Can't get profile: ".concat(c.message)}})),[3,7];case 7:return[2,{users:o||[]}];case 8:return n.isMpWeb?[2,Promise.resolve({users:[]})]:[2,Promise.reject(t("openProfilePicker",{}))]}}))})),function(e){return c.apply(this,arguments)}))];var c}))})),p.apply(this,arguments)}export{c as openProfilePicker};
