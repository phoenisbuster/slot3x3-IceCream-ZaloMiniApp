import e from'./../../external/@swc/helpers/src/_object_spread.mjs.js';import r from"../../utils/lodash.js";import{logger as o}from"../logger.js";import{AppError as n}from"../../utils/errorHandler.js";import{ACTION as s,ApiCallStage as i,RESPONSE_CODE as t,RESPONSE as a,COMMON_NATIVE_ERROR_CODE as l}from"../../constants.js";import m from"./zaloNative.js";import u from"../token.js";import d from"../../appEnv/getEnv.js";import{JumpStatus as c}from"../../types/enum.js";var p,f=(p=function(e){var r,o,i,m=null===(r=d())||void 0===r?void 0:r.platformName,p=e.action.replace("action.","").replace(/\./g,"_").toUpperCase(),f=s[p],v=(null==f?void 0:f.skipJump)||!1,g=(null==f?void 0:f.errorList)||{};if("JUMP_LOGIN"===p)return new n(t.UNKNOWN_ERROR,"Can not get auth code: ".concat(e.error_message));if(u.jumpStatus!==c.DONE&&!v)return new n(a.UNAUTHORIZED.code,a.UNAUTHORIZED.message);if("permission required!"===String(e.error_message).toLowerCase()||"no permission!"===String(e.error_message).toLowerCase())return new n(a.FORBIDDEN.code,a.FORBIDDEN.message);if(m&&(null===(o=l[m])||void 0===o?void 0:o[e.error_code]))return new n(l[m][e.error_code].code,l[m][e.error_code].message);var _=null==g||null===(i=g[m])||void 0===i?void 0:i[String(e.error_code)];if(_){var j,N,E,O=null===(j=_.mapTo)||void 0===j?void 0:j.message;return(null==_?void 0:_.needMoreDetail)&&(O="".concat(null==_||null===(E=_.mapTo)||void 0===E?void 0:E.message,": ").concat(e.error_message)),new n(null===(N=_.mapTo)||void 0===N?void 0:N.code,O)}return new n(e.error_code,e.error_message)},function(n,t,a,l){var u=function(e,n){function s(s){return function(t){var a=r.isEmpty(n)?void 0:n[s];if(a)return o({stage:i.RESPONSE,type:"log",state:s,name:e,response:t}),a("fail"===s?p(t):null==t?void 0:t.data)}}return r.isUndefined(e)&&(e=""),Object.assign({},{success:s("success"),fail:s("fail")})}(n,a),d=s[n],c=(null==l?void 0:l.delay)||0;setTimeout((function(){m(n,t,u,e({},l,d))}),c)});export{f as default};
