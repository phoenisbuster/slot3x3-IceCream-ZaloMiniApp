import o from'./../../external/@swc/helpers/src/_async_to_generator.mjs.js';import{RESPONSE_CODE as e,MESSAGES as a}from"../../constants.js";import t from"../../utils/lodash.js";import{MPEEmitter as i,onActionMessage as n,fireActionMessage as r}from"../eventEmitter.js";import{parseJSON as l,getDynamicAPIByAction as c,checkIOSSupportAction as s,serialize as u}from"../../utils/common.js";import d from"../token.js";import{sendLogData as m}from"../utils.js";import v from"../../appEnv/getEnv.js";import{__generator as p}from'./../../external/tslib/tslib.es6.js';import{Events as f}from"../../types/enum.js";var _,g,h,T,I,b,j=(h=v(),T={},I=i.getInstance(),b=[],!1||(n((function(o){var e=o.serialId,a=l(o.result),i=c(null==a?void 0:a.action),n=t.isEmpty(null==a?void 0:a.error_code)?0:null==a?void 0:a.error_code,r=null==a?void 0:a.error_message,s=(null==a?void 0:a.data)||a;if(i&&0===n){var u=JSON.parse(null==a?void 0:a.data);n=t.isEmpty(null==u?void 0:u.error_code)?0:null==u?void 0:u.error_code,r=null==u?void 0:u.error_message,s=(null==u?void 0:u.data)||u}var d={error_code:n,error_message:r,data:s,action:(null==a?void 0:a.action)||o.actionName};if(e&&T[e]){var m=T[e],v=m.callback,p=m.timeout,f=m.isMultiCallback,_=m.options;!function(o,e){var a=e||{},i=a.success,n=a.fail;0===o.error_code?t.isFunction(i)&&i(o):t.isFunction(n)&&n(o)}(d,v),!f&&delete T[e],p&&clearTimeout(p);var g={action:null==d?void 0:d.action,error:null==d?void 0:d.error_code,message:null==d?void 0:d.error_message,data:{}};try{if("action.open.inapp"===d.action||"action.open.outapp"===d.action){var h=new URL(null==_?void 0:_.url),I="".concat(h.protocol,"//").concat(h.host).concat(h.pathname);g.data={url:I}}if("action.follow.oa"===d.action||"action.unfollow.oa"===d.action){var j=null==_?void 0:_.uid;g.data={uid:j}}if("action.open.chat"===d.action){var M=null==_?void 0:_.uId,k=null==_?void 0:_.type;g.data={uid:M,openChatType:k}}}catch(o){}b.push(g)}})),I.on(f.AppPaused,(function(){if(b.length>0){var o=b;b=[],m(o)}})),_?clearInterval(_):_=setInterval((function(){if(b.length>0){var o=b;b=[],m(o)}}),5e3),!0),g=o((function(o,i,n,l){var m,v,f,_,g,I,b,j,M,k,N,w,C,E,O,S,y,U;return p(this,(function(p){switch(p.label){case 0:return v=Math.floor(1e6*Math.random()),f="".concat(o,"_").concat(v),_="action.".concat(o.replace(/\_/g,".").toLowerCase()),(null==l?void 0:l.actionName)&&l.actionName.length>0&&(_=null==l?void 0:l.actionName),g=(null==l?void 0:l.isMultiCallback)||!1,I=!1!==(null==l?void 0:l.timeout)&&((null==l?void 0:l.timeout)||!0),b=(null==l?void 0:l.haveActionCallback)||!1,j=(null==l?void 0:l.skipJump)||!1,M=(null==l?void 0:l.requireAccessToken)||!1,i&&n&&(T[f]={options:i,callback:n,isMultiCallback:g},I&&b&&(T[f].timeout=setTimeout((function(){var t={serialId:f,result:{error_code:e.TIME_OUT,error_message:a.TIME_OUT,data:{timeout:I},action:o}};r(t)}),!0===I?8e3:1e3*I))),k=c(_),!(null==h||null===(m=h.platform)||void 0===m?void 0:m.isMobile)||!o||t.isUndefined(ZaloJavaScriptInterface)||h.platform.isIOS&&!s(o)||k&&!1===k.isSupported?(w={serialId:f,result:{error_code:e.CLIENT_NOT_SUPPORT,error_message:a.CLIENT_NOT_SUPPORT,data:{isMobile:null==h||null===(N=h.platform)||void 0===N?void 0:N.isMobile},action:o}},r(w),[2]):(C=u(i),j?[3,2]:[4,d.getJSAccessToken()]);case 1:return O=p.sent(),[3,3];case 2:O="",p.label=3;case 3:return E=O,j||!M?[3,5]:[4,d.getAccessToken()];case 4:return y=p.sent(),[3,6];case 5:y="",p.label=6;case 6:return S=y,U=h.platform.isIOS?window.onNativeMessage(f,_):'window.onNativeMessage("'.concat(f,'", "').concat(_,'")'),[2,ZaloJavaScriptInterface.jsCall(E,_,S,C,U)]}}))})),function(o,e,a,t){return g.apply(this,arguments)});export{j as default};
