import e from'./../../../../external/@swc/helpers/src/_async_to_generator.mjs.js';import t from'./../../../../external/@swc/helpers/src/_class_call_check.mjs.js';import r from'./../../../../external/@swc/helpers/src/_class_private_field_get.mjs.js';import s from'./../../../../external/@swc/helpers/src/_class_private_field_init.mjs.js';import n from'./../../../../external/@swc/helpers/src/_class_private_field_set.mjs.js';import i from'./../../../../external/@swc/helpers/src/_sliced_to_array.mjs.js';import o from"../../../../utils/lodash.js";import{calcLocalStorageSize as c}from"../../../../utils/common.js";import{STORAGE_LIMIT as a}from"../../../../constants.js";import{__generator as u}from'./../../../../external/tslib/tslib.es6.js';var l=new WeakMap,m=new WeakMap,f=new WeakMap,h=function(){function h(e){t(this,h),s(this,l,{writable:!0,value:localStorage}),s(this,m,{writable:!0,value:void 0}),s(this,f,{writable:!0,value:void 0}),n(this,f,{keys:new Set,currentSize:0,limitSize:a}),n(this,m,e),this.findAllCurrentDataByApp(e)}var d=h.prototype;return d.findAllCurrentDataByApp=function(e){try{var t;for(t in r(this,l)){if(e)if(t.split("_")[0]!==e)continue;r(this,f).keys.add(t)}}catch(e){}},d.get=function(e){var t=this,r=new Map;return e.forEach((function(e){r.set(e,t.getSync(e))})),Promise.resolve(r)},d.getSync=function(e){return r(this,m)&&(e="".concat(r(this,m),"_").concat(e)),r(this,f).keys.has(e)?r(this,l).getItem(e):null},d.set=function(t){var r=this;return e((function(){return u(this,(function(e){return Object.entries(t).forEach((function(e){var t=i(e,2),s=t[0],n=t[1];r.setSync(s,n.replace(/\\"/g,'"'))})),[2,Promise.resolve({errorKeys:[]})]}))}))()},d.setSync=function(e,t){r(this,m)&&(e="".concat(r(this,m),"_").concat(e)),r(this,l).setItem(e,t),r(this,f).keys.add(e)},d.getInfo=function(){var t=this;return e((function(){return u(this,(function(e){return[2,Promise.resolve(t.getInfoSync())]}))}))()},d.getInfoSync=function(){var e=c(r(this,l),r(this,m));return{currentSize:o.isNumber(e)?Number((e/1024).toFixed(2)):0,limitSize:Number((a/1024).toFixed(2))}},d.remove=function(t){var r=this;return e((function(){return u(this,(function(e){return t.forEach((function(e){r.removeSync(e)})),[2,Promise.resolve({errorKeys:[]})]}))}))()},d.removeSync=function(e){r(this,m)&&(e="".concat(r(this,m),"_").concat(e)),r(this,f).keys.has(e)&&(r(this,l).removeItem(e),r(this,f).keys.delete(e))},d.clear=function(){var t=this;return e((function(){return u(this,(function(e){return[2,Promise.resolve(t.clearSync())]}))}))()},d.clearSync=function(){var e=this;r(this,f).keys.forEach((function(t){r(e,m)&&t.indexOf(r(e,m))<0||(r(e,l).removeItem(t),r(e,f).keys.delete(t))}))},h}();export{h as LocalResourceStorage};
