import s from'./../../../../external/@swc/helpers/src/_async_to_generator.mjs.js';import t from'./../../../../external/@swc/helpers/src/_class_call_check.mjs.js';import e from'./../../../../external/@swc/helpers/src/_class_private_field_get.mjs.js';import r from'./../../../../external/@swc/helpers/src/_class_private_field_init.mjs.js';import n from'./../../../../external/@swc/helpers/src/_class_private_field_set.mjs.js';import i from"../../../../utils/lodash.js";import{STORAGE_LIMIT as a}from"../../../../constants.js";import o from"../../../call/index.js";import{__generator as c}from'./../../../../external/tslib/tslib.es6.js';var u=new WeakMap,m=new WeakMap,d=function(){function d(s){t(this,d),r(this,u,{writable:!0,value:void 0}),r(this,m,{writable:!0,value:void 0}),n(this,m,{keys:new Set,currentSize:0,limitSize:a}),n(this,u,s)}var p=d.prototype;return p.get=function(t){var r=this;return s((function(){return c(this,(function(s){return[2,new Promise((function(s,n){o("ZBROWSER_MPDS",{mpds_action:"mpds.get",mpds_data:{keys:t},appId:e(r,u)},{success:function(t){var e=new Map;t&&t.mpds_data&&t.mpds_data.map&&(e=new Map(Object.entries(t.mpds_data.map))),s(e)},fail:function(s){n(s)}},{isMultiCallback:!1})}))]}))}))()},p.set=function(t){var r=this;return s((function(){return c(this,(function(s){return[2,new Promise((function(s,n){o("ZBROWSER_MPDS",{mpds_action:"mpds.set",mpds_data:{map:t},appId:e(r,u)},{success:function(t){var e=[];t&&t.mpds_data&&t.mpds_data.error_keys&&(e=t.mpds_data.error_keys),s({errorKeys:e})},fail:function(s){n(s)}},{isMultiCallback:!1})}))]}))}))()},p.getInfo=function(){var t=this;return s((function(){return c(this,(function(s){return[2,new Promise((function(s,r){o("ZBROWSER_MPDS",{mpds_action:"mpds.get.size",mpds_data:{},appId:e(t,u)},{success:function(t){var e=0;t&&t.mpds_data&&t.mpds_data.size&&(e=t.mpds_data.size),s({currentSize:i.isNumber(e)?Number(Number(e)/1024):0,limitSize:Number(a/1024)})},fail:function(s){r(s)}},{isMultiCallback:!1})}))]}))}))()},p.remove=function(t){var r=this;return s((function(){return c(this,(function(s){return[2,new Promise((function(s,n){o("ZBROWSER_MPDS",{mpds_action:"mpds.remove.key",mpds_data:{keys:t},appId:e(r,u)},{success:function(t){var e=[];t&&t.mpds_data&&t.mpds_data.error_keys&&(e=t.mpds_data.error_keys),s({errorKeys:e})},fail:function(s){n(s)}},{isMultiCallback:!1})}))]}))}))()},p.clear=function(){var t=this;return s((function(){return c(this,(function(s){return[2,new Promise((function(s,r){o("ZBROWSER_MPDS",{mpds_action:"mpds.clear.appData",mpds_data:{},appId:e(t,u)},{success:function(t){s()},fail:function(s){r(s)}},{isMultiCallback:!1})}))]}))}))()},d}();export{d as NativeResourceStorage};
