import e from'./../../../external/@swc/helpers/src/_async_to_generator.mjs.js';import n from'./../../../external/@swc/helpers/src/_object_spread.mjs.js';import r from'./../../../external/@swc/helpers/src/_object_spread_props.mjs.js';import t from"../../call/index.js";import i from"../../token.js";import{ZAPP_ID as o,APP_ID as l,ZALO_SUPPORT_SHARE_MULTI_IMAGE_VERSION as s}from"../../../constants.js";import a from"./getZMPShareInfo.js";import{__generator as u}from'./../../../external/tslib/tslib.es6.js';import{ShareSheetType as d}from"../../../types/enum.js";import c from"../../../appEnv/getEnv.js";var m,p=(m=e((function(e,m){var p,h,v,f,g,_,j,U,b,w;return u(this,(function(u){switch(u.label){case 0:switch(p={},h=e,e){case"image":return[3,1];case"gif":return[3,2];case"video":return[3,3];case"link":return[3,4];case"oa":return[3,5];case"zmp":return[3,6];case"zmp_deep_link":return[3,9]}return[3,12];case 1:return _=[],j=(null===(f=c())||void 0===f?void 0:f.zaloVersion)||0,U=(null===(g=c())||void 0===g?void 0:g.platformName)||"unknown",Number(j)>=s[U]&&(h="multi_image"),Array.isArray(null==m?void 0:m.imageUrls)&&(null==m?void 0:m.imageUrls.length)>0?_=null==m?void 0:m.imageUrls:_.push(null==m?void 0:m.imageUrl),p={photoUrls:_,photoUrl:null==m?void 0:m.imageUrl,caption:null==m?void 0:m.caption},[3,13];case 2:return p={photoUrl:null==m?void 0:m.imageUrl,gifUrl:null==m?void 0:m.gifUrl,width:null==m?void 0:m.width,height:null==m?void 0:m.height},[3,13];case 3:return p={videoThumb:null==m?void 0:m.videoThumb,videoUrl:null==m?void 0:m.videoUrl,width:null==m?void 0:m.width,height:null==m?void 0:m.height},[3,13];case 4:return p={link:null==m?void 0:m.link,chatOnly:(null==m?void 0:m.chatOnly)?1:0},[3,13];case 5:return p={uid:null==m?void 0:m.id},[3,13];case 6:case 9:return[4,i.getAccessToken()];case 7:case 10:return v=u.sent(),[4,a(l,v||"",(null==m?void 0:m.title)||"",(null==m?void 0:m.description)||"",(null==m?void 0:m.thumbnail)||"",null==m?void 0:m.path)];case 8:return b=u.sent(),p={data:{ZInstantAPIInfo:{url:"".concat(b.zinstantApi),zinstantdata_id:"templateId=".concat(b.ztemplateId,"&appId=").concat(l,"&shareId=").concat(b.shareId)},previewMsgText:{msg:{en:"Zalo Mini Program",vi:"Chương trình nhỏ"}},enableReactions:1}},[3,13];case 11:return w=u.sent().shareableLink,p={link:w,chatOnly:0},[3,13];case 12:return[3,13];case 13:return[2,new Promise((function(e,i){t("OPEN_SHARESHEET",r(n({type:d[h]},p),{zapp:o}),{success:function(n){e({status:null==n?void 0:n.status,shareType:null==n?void 0:n.share_type,numberOfUser:null==n?void 0:n.uid_to_size})},fail:function(e){i(e)}},{timeout:!1})}))]}}))})),function(e,n){return m.apply(this,arguments)});export{p as default};
